Shell 程序的变量和参数  & Shell 程序的运行



Shell 程序的变量和参数 

Shell 变量可以保存诸如路径名、文件名或者一个数字。对 Shell 来讲，所有变量的取值都是一个字符串。Shell 程序采用 $var 的形式来引用名为 var 的变量的值。Shell 有以下 5 中基本类型的变量

（1）用户定义的变量

1. 说明一个变量为只读

   readonly 变量名

   变量默认都是当前 Shell 的局部变量，将变量变为公共变量的格式为

   export 变量名

   也可以在给变量赋值的同时使用 export 命令：export 变量名 = 变量值

   使用 export 说明的变量，在 Shell 以后运行的所有命令或程序中都可以访问到

2. 定义自己的变量

   变量名 = 变量值

   或 $ {变量名 = 变量值}

   在定义变量时，变量名前不应加符号 “$”，在引用变量的内容时，则应在变量名前加 “$”；在给变量赋值时，等号两边一定不能空格，若变量中本身就包含了空格，则整个字符串都要用双括号括起来。

3. 清楚变量

   使用 unset 命令清楚变量

   例如：

   unset varname

4. 显示变量

   使用 echo 命令可以显示单个变量取值，并在变量名前加 $.

   例如：

   $ myvar = “hello world”

   $ echo $myvar

   显示所有本地 Shell 变量

   使用 set 命令显示所有本地定义的 Shell 变量

（2）Shell 定义的环境变量

Shell 在开始执行时就已经定义了一些和系统的工作环境有关的变量，这些变量用户还可以重新定义。环境变量可以在命令行中设置，但用户注销时这些值将丢失，因此，最好在 .bash_profile 或 /etc/profile 文件中设置环境变量。传统上，所有环境变量均为大写。

1. 设置环境变量

   VARNAME = value ； export VARNAME

2. 清除环境变量

   使用 unset 命令清除环境变量

3. 显示环境变量

   使用 env 命令可以查看所有的环境变量



（3）常用的 Shell 环境变量

1. HOME ：用于保存注册目录的完整路径名
2. UID ：当前用户的标识符，取值是由数字构成的字符串
3. PWD ：当前工作目录的绝对路径名，该变量的取值随 cd 命令的使用而变化
4. SHELL ：SHELL 变量保存默认 Shell，通常在 /etc/passwd 中已设置
5. PATH ：用于保存用冒号分隔的目录路径名，Shell 将按 PATH 变量中给出的顺序搜索这些目录，找到的第一个与命令名称一致的可执行文件将被执行
6. TERM ：终端的类型
7. LOGNAME ：此表量保存登录名

（4）预定义变量

预定义变量与环境变量相似，也是在 Shell 开始时就定义了的变量，所不同的是，用户只能根据 Shell 的定义来使用这些变量，而不能重定义，所有预定义变量都是由 $ 符号和另一个符号组成的，常用的 Shell 预定义变量有以下 6 种：

1. $# ：位置参数的数量
2. $* ：所有位置参数的内容
3. $? ：命令执行后返回的状态
4. $$ ：当前进程的进程号
5. $! ：后台运行的最后一个进程号
6. $0 ：当前执行的进程名



（5）位置参数

位置参数是一种在调用 Shell 程序的命令行中按照各自的位置决定的变量，是在程序名之后输入的参数



位置参数之间用空格分隔，Shell 取第一个位置参数替换程序文件中的 $1，第二个替换 $2，依次类推。$0 是一个特殊的变量，它的内容是当前这个 Shell 程序的文件名，所以，$0 不是一个位置参数，在显示当前所有的位置参数时是不包括 $0 的



Shell 程序的运行



用户可以用任何编辑程序来编写 Shell 程序。按照 Shell 编程的惯例，以 bash 为例，程序的第一行一般为 “#! /bin/bash”，其中，“#” 表示该行是注释，“!” 表示 Shell 运行 “!” 之后的命令并用文档的其余部分作为输入，也就是运行 /bin/bash，并让 /bin/bash 去执行 Shell 程序的内容



执行 Shell 程序的方法有如下 3 种

（1）sh Shell 程序文件名

这种方法的命令格式为

bash Shell 程序文件名

这实际上是调用一个新的 bash 命令解释程序，而把 Shell 程序文件名作为参数传递给它。新启动的 Shell 将去读指定的文件，可执行文件中列出的命令，当所有的命令都执行完后结束。



（2）sh

这种方法的命令格式为

bash<Shell 程序名

这种方式就是利用输入重定向，使 Shell 命令解释程序的输入取自指定的程序文件。



（3）chmod 命令

用 chmod 命令使 Shell 程序成为可执行

一个文件能否运行取决于该文档的内容本身可执行且该文件具有执行权。对于 Shell 程序，当用编辑器生成一个文件时，系统赋予的许可权都是 644(rw-r-r--)，因此，当用户需要运行这个文件时，只需要直接输入文件名即可



bash 程序的调试

在编程过程中难免会出错，有时候，调试程序比编写程序花费的时间还要多，Shell 程序同样如此。Shell 程序的调试主要是利用 bash 命令解释程序的选择项。调用 bash 的形式为

bash -选择项 Shell 程序文件名

几个常用的选择项如下：

1. -e ：如果一个命令失败就立即退出
2. -n ：读入命令但是不执行
3. -u ：置换时把未设置的变量看作出错
4. -v ：当读入 Shell 输入行时把命令和它们的参数显示出来
5. -x ：执行命令时把命令和它们的参数显示出来

上面的所有选项也可以在 Shell 程序内部用 “set -选择项” 的形式引用，而 “set +选择项” 则将禁用该选择项起作用。如果只想对程序的某一部分使用某些选择项时，则可以将该部分用上面两个语句包围起来。

